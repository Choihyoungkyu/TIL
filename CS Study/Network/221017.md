# 221017



### 2계층에서 하는 일

- 2계층의 기능
  - 하나의 네트워크 대역. 즉, **같은 네트워크 상**에 존재하는 여러 장비들 중에서 **어떤 장비가 어떤 장비에게 보내는 데이터를 전달**
  - **오류제어, 흐름제어** 수행



#### 2계층의 네트워크 크기

- 2계층은 하나의 네트워크 대역 LAN에서만 통신할 때 사용
- 다른 네트워크와 통신할 때는 항상 **3계층**의 도움이 필요



#### 2계층에서 사용하는 주소

- MAC 주소 (=물리적 주소) : LAN 에서 통신할 때 사용하는 주소

- 물리적 주소 
  - ex) 6C-29-95-04-EB-A1
  - OUI + 고유번호
  - OUI : IEEE에서 부여하는 일종의 제조회사 식별 ID
  - 고유번호 : 제조사에서 부여한 고유번호



#### 2계층의 프로토콜

- **Eternet 프로토콜** (총 14 bytes)

![1_4](C:\Users\Choi\Desktop\TIL\CS Study\Network\images\1_4.PNG)

![image-20221016100847322](images/1_4.png)

- Destination Address (도착지 주소, 데이터를 받는 쪽의 MAC 주소) : 6 bytes
- Source Address(출발지 주소, 데이터를 보내는 쪽의 MAC 주소) : 6 bytes
- Ethernet Type : 2 bytes --> 상위 프로토콜 타입 (올 수 있는 프로토콜 : IPv4(0x0800), ARP(0x0806))
- DATA : 페이로드



#### [실습]

```
# cmd
ipconfig /all	-->	  무선 LAN 어댑터 로컬 영역 확인
```

---



## 3계층

#### 3계층의 기능

- 다른 네트워크 대역, 즉 멀리 떨어진 곳에 존재하는 네트워크까지 어떻게 데이터를 전달할지 제어하는 일을 담당
- LAN과 LAN을 연결해주는 기능



#### 3계층에서 쓰는 주소

- WAN에서 통신할 때 사용하는 IP 주소
- 기본 설정
  - '나'를 나타내는 요소
    - IPv4 주소 : 현재 PC에 할당된 IP 주소
    - 서브넷 마스크 : IP 주소에 대한 네트워크의 대역을 규정하는 것
  - 외부 세상으로 나가는 문을 나타내는 요소
    - 기본 게이트웨이 : 외부와 통신할 때 사용하는 네트워크의 출입구



#### 3계층 프로토콜

- ART 프로토콜 : IP주소를 이용해 MAC주소를 알아오는 프로토콜
- IPv4 프로토콜 : WAN에서 통신할 때 사용하는 프로토콜

- ICMP 프로토콜 : 서로가 통신되는지 확인할 때 사용하는 프로토콜

---



## IP 주소

#### 일반적인 IP 주소

- Classful IP 주소 (옛날에 사용하던 주소)

  ![image-20221016102648426](images/2_1.png)

- Classless IP 주소

  ![image-20221016103958116](images/2_2.png)

  - 서브넷 마스크

    - 클래스풀한 네트워크 대역을 나눠주는데 사용하는 값
    - 어디까지가 네트워크 대역을 구분하는데 사용하고 어디서부터 호스트를 구분하는데 사용하는지 지정
    - 32bit 4bytes

    255.255.255.192 -> 11111111.11111111.11111111.11000000

    2진수로 표기했을 때 1로 시작, 1과 1사이에는 0이 올수 없다는 규칙을 가지고 있다.

    ex) 192.168.100.68     255.255.255.192와 같이 IP주소와 서브넷마스크를 쓰면?
    192.168.100.0와 같이 C클래스에 해당하는 네트워크를 192.168.100.0, 192.168.100.64, 192.168.100.128, 192.168.100.192와 같이 4개의 작은 네트워크 대역으로 나눈 것이고 해당 IP 주소는 2번째 네트워크에 해당하는 것이다.

- 사설 IP와 공인 IP
  - 공인 IP : 인터넷 세상(네트워크 통신망)과 통신할 때 사용하는 IP 주소
  - 사설 IP : 같은 네트워크 대역에서 사용하는 IP 주소
  - NAT (Network Address Translation) : 사설 IP에서 공인 IP로 바꿔주는 것
  - 실제 인터넷 세상에서는 공인 IP로만 통신
    외부 네트워크 대역에서는 사설 IP 대역이 보이지 않는다.
  - 통신 과정
    - 사설 IP에서 요청 -> 공유기의 NAT Table에 요청을 기록하고 다른 공인 IP에 데이터를 요청 -> 요청받은 서버에서 데이터를 공유기에 전송 -> 데이터를 받은 공유기가 NAT Table을 통해 어느 사설 IP로 보낼지 확인
    - 만약 NAT Table에 기록되지 않은 데이터를 받은 공유기는 그대로 공유기가 데이터를 흡수(?)
    - 그래서 네이버 같은 서버는 사설 IP를 사용하지 않고 공인 IP를 사용
  - 일반적으로 외부에서 사설 IP로 바로 접근 불가
    - 포트포워딩이라는 작업을 통해 바로 접근 가능

- 특수한 IP 주소
  - Wildcard : 0.0.0.0/0
    - 나머지 모든 IP
  - 나 자신을 나타내는 주소 : 127.0.0.1
  - 어딘가로 가려면 일단 여기로 : 게이트웨이 주소
    - 네트워크 대역에서 가장 낮거나 높은 주소를 사용

---



## ARP 프로토콜

#### ARP가 하는 일

- 같은 네트워크 대역에서 통신을 하기 위해 필요한 MAC 주소를 IP 주소를 이용해서 알아오는 프로토콜
- 같은 네트워크 대역에서 통신을 한다고 하더라도 데이터를 보내기 위해서는 7계층부터 캡슐화를 통해 데이터를 보내기 때문에 IP 주소와 MAC 주소가 모두 필요하다.
- 이때, IP 주소는 알고 MAC 주소는 모르더라도 ARP를 통해 통신이 가능하다.



#### ARP 프로토콜의 구조

![image-20221016121009661](images/2_3.png)

- Source Hardware Address : 출발지 MAC 주소, 보내는 쪽의 MAC 주소
- Source Protocol Address : 출발지 IP 주소, 보내는 쪽의 IP 주소
- Destination Hardware Address : 도착지 MAC 주소, 받는 쪽의 MAC 주소
- Destination Protocol Address : 도착지 IP 주소, 받는 쪽의 IP 주소

- Hardware type : 2계층에서 사용하는 프로토콜
  - 거의 보통 이더넷 (00.01)
- Protocol type : 거의 보통 IPv4 (08.00)
- Hardware Address Length : Hardware Address의 길이 6 bytes -> (06)
- Protocol Address Length : Protocol Address의 길이 4 bytes -> (04)
- Opcode : 어떻게 동작하는지 나타내는 코드
  - 요청 : 1
  - 응답 : 2



#### ARP 요청 과정

서로의 IP 주소만 알고 MAC 주소를 모를 때

1. 본인의 IP 주소와 MAC 주소를 3계층인 ARP과 2계층인 Ethernet에 입력하고 모르는 부분을 비워놓은채 캡슐화 한 뒤 스위치에 전송
2. 스위치는 다른 모든 장치에 캡슐화된 정보를 전송 (브로드캐스트)
3. 각각 전송받은 캡슐을 디캡슐화하여 정보 읽음
4. 2계층인 이더넷은 모든 정보에 대한 요청이므로 다음 계층인 3계층을 디캡슐화
5. 3계층인 ARP에서 IP 주소를 읽고 일치하면 자신의 MAC 주소를 입력하고 다시 캡슐화 진행 후 스위치에 전달
6. 스위치는 다시 요청한 장치에 전달받은 정보를 전달
7. **상대방의 MAC 주소를 받은 뒤 ARP 캐시 테이블에 상대 장치의 IP 주소와 MAC 주소를 저장한 뒤 데이터 통신 진행**

```
# cmd
arp -a		-->		통신 했던 컴퓨터들의 주소는 ARP 테이블에 저장됨
```



#### [참고]

ARP 프로토콜은 3계층이지만 같은 네트워크 대역에서만 쓰임
MAC 주소를 몰라서 이더넷 프로토콜로 브로드캐스트 하기 때문에
(브로드캐스트는 외부 네트워크에 전송하지 않음)





