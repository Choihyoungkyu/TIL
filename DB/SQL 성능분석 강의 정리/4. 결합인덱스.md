# 결합인덱스

---

## 1. 결합인덱스의 구성

#### 결합인덱스 컬럼 선택

1. **WHERE 절에서 AND 조건으로 자주 결합되어 사용되면서 각각의 분포도 보다 두 개 이상의 컬럼이 결합될 때 분포도가 좋아지는 컬럼들**
2. 다른 테이블과 조인의 연결고리로 자주 사용되는 컬럼들
3. 하나 이상의 키 컬럼 조건으로 같은 테이블의 컬럼들이 자주 조회될 때, 이러한 컬럼을 모두 포함(결합)



#### 결합인덱스의 컬럼 순서 결정

1. WHERE 절 조건에 많이 사용되는 컬럼 우선

2. Equal('=')로 사용되는 컬럼 우선

3. 분포도가 좋은 컬럼 우선

4. 자주 이용되는 Sort의 순서로 결정

   (고정된 Sort의 순서를 가진 SQL문이 자주 사용되는 경우에는 3번과 4번의 비중이 바뀔 수 있음)



## 2. 결합인덱스 사용 방법

1. 결합인덱스 사용 가능한 예
   - EMP_PAY_X1 : (급여연월, 급여코드, 사원번호) -> 급여연월 조건이 있기 때문에 사용 가능
     1. `WHERE 급여연월 = '201610';`
     2. `WHERE 급여연월 = '201610' AND 급여코드 = '정기급여';`
     3. `WHERE 급여연월 = '201610' AND 급여코드 = '정기급여' AND 사원번호 = '33139649';`
2. INDEX SKIP SCANNING
   - Skip Scanning : 결합인덱스의 첫 번째 컬럼이 WHERE절에서 제외되어 있고, 두 번째 컬럼부터 WHERE절에 조건으로 기술되어 있는 경우에도, 그 인덱스가 사용되는 경우
   - Skip Scanning을 위한 힌트
     1. `INDEX_SS(table명 index명)`
     2. `INDEX_SS_ASC(table명 index명)`
     3. `INDEX_SS_DESC(table명 index명)`



## 3. 결합인덱스 컬럼에 대한 '='의 의미

1. 범위 제한 조건

   - AREA_X1 : (시, 구, 동)
     1. `WHERE 시 = '서울시';`
     2. `WHERE 시 = '서울시' AND 구 = '강남구';`
     3. `WHERE 시 = '서울시' AND 구 = '강남구' AND 동 = '역삼동';`

2. 체크 조건

   - AREA_X1 : (시, 구, 동)
     1. `WHERE 시 LIKE '서%' AND 구 = '강남구' AND 동 = '역삼동';`
        - 구 = '강남구', 동 = '역삼동' 부분이 체크 조건이 돼서 바로 찾아가지 못함
     2. `WHERE 시 = '서울시' AND 구 LIKE '강%' AND 동 = '역삼동';`
        - 동 = '역삼동' 부분이 체크 조건이 돼서 바로 찾아가지 못함
     3. `WHERE 시 = '서울시' AND 동 = '역삼동';`
        - 동 = '역삼동' 부분이 체크 조건이 돼서 바로 찾아가지 못함

3. 인덱스 매칭률

   - 인덱스 매칭률 = (WHERE절에서 1st 컬럼부터 연속된 컬럼에 대해 상수(값)를 '='로 비교하는 컬럼의 개수) / (인덱스를 구성하는 컬럼의 총 개수)
   - AREA_X1 : (시, 구, 동)
     1. `WHERE 시 = '서울시';`
        - 매칭률 = 1/3
     2. `WHERE 시 = '서울시' AND 구 = '강남구';`
        - 매칭률 = 2/3
     3. `WHERE 시 = '서울시' AND 구 = '강남구' AND 동 = '역삼동';`
        - 매칭률 = 3/3

4. 인덱스 매칭률 향상을 통한 속도 개선

   - EMP_PAY_X1 : (급여연월, 급여코드, 사원번호)

     ```sql
     WHERE 급여연월 LIKE '2016%' AND 급여코드 = '정기급여'; --> 매칭률 1/3
     ```

     ```sql
     WHERE 급여연월 IN ('201612', '201611', '201610') ANd 급여코드 = '정기급여'; --> 매칭률 2/3
     ```



---

## Summary

1. 인덱스 머지(Index Merge) vs 결합인덱스
   - 인덱스 머지란 개별 컬럼에 인덱스가 생성되어 있으면서 모두 WHERE 절에 Equal(=) 조건으로 사용되어, 각각의 인덱스 조합으로 자료에 접근하는 것을 의미함
   - 일반적으로 결합인덱스를 사용할 경우, 좋은 엑세스 경로를 제공함
2. 결합인덱스의 구성
   - 결합인덱스 컬럼 순서 결정
     - WHERE 절 조건에 많이 사용되는 컬럼
     - Equal(=)로 사용되는 컬럼
     - 분포도가 좋은 컬럼
     - 자주 이용되는 Sort의 순서로 결정
3. 결합인덱스 사용 방법
   - 결합인덱스의 첫 번째 컬럼이 WHERE절에서 제외되어 있는 경우, 결합인덱스를 사용할 수 없음
   - 인덱스 스킵 스캐닝(Index Skip Scanning)
     - 결합인덱스의 첫 번째 컬럼이 WHERE절에서 제외되어 있고, 두 번째 컬럼부터 WHERE절에 조건으로 기술되어 있는 경우에도, 그 인덱스가 사용되는 경우임
4. 결합인덱스 컬럼에 대한 '='의 의미
   - 범위 제한 조건
     - 결합 인덱스의 선행하는 컬럼(첫 번째 컬럼 포함) 순서로 WHERE절에 '='로 연속된 경우, 해당하는 조건을 범위제한 조건이라 함
   - 체크 조건
     - WHERE절 조건에서 선행 컬럼이 '='조건에 없다면 후행 조건은 체크조건이 됨
   - 인덱스 매칭률
     - (WHERE절에서 1st 컬럼부터 연속된 컬럼에 대해 상수(값)를 '='로 비교하는 컬럼의 개수) / (인덱스를 구성하는 컬럼의 총 개수)

